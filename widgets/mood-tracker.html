<div class="mood-widget" x-data="moodTracker()" x-init="init()">
    <div class="mood-header">
        <h3 class="mood-title">Mood Tracker</h3>
        <input type="date" x-model="selectedDate" @change="loadMoodForDate()" class="mood-date-picker">
    </div>

    <div class="mood-question">Jak se dnes c√≠t√≠≈°?</div>

    <div class="mood-options">
        <template x-for="m in moodTypes" :key="m.label">
            <button @click="saveMood(m.emoji)" 
                    :class="{'active': currentMood === m.emoji}"
                    class="mood-btn" 
                    :title="m.label">
                <span x-text="m.emoji"></span>
            </button>
        </template>
    </div>

    <div class="mood-history">
        <div class="history-title">Posledn√≠ch 7 dn√≠</div>
        <div class="history-grid">
            <template x-for="day in lastWeek" :key="day.date">
                <div class="history-item">
                    <span class="history-date" x-text="day.label"></span>
                    <div class="history-emoji" :class="{'empty': !history[day.date]}" 
                         x-text="history[day.date] || '‚Ä¢'"></div>
                </div>
            </template>
        </div>
    </div>
</div>

<style>
    .mood-widget {
        color: var(--text-main);
        padding: 15px;
    }
    .mood-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    .mood-title { color: var(--accent-color); margin: 0; font-size: 1.1rem; }
    
    .mood-date-picker {
        background: transparent;
        border: 1px solid var(--border-color);
        color: var(--text-main);
        padding: 2px 5px;
        border-radius: 4px;
        font-size: 0.8rem;
    }

    .mood-question {
        text-align: center;
        margin-bottom: 15px;
        font-size: 1rem;
        color: var(--text-muted);
    }

    .mood-options {
        display: flex;
        justify-content: space-around;
        margin-bottom: 20px;
    }

    .mood-btn {
        background: var(--widget-bg);
        border: 2px solid var(--border-color);
        font-size: 1.5rem;
        padding: 8px;
        border-radius: 12px;
        cursor: pointer;
        transition: 0.3s;
        width: 50px;
    }

    .mood-btn:hover { border-color: var(--accent-color); transform: translateY(-3px); }
    .mood-btn.active { border-color: var(--accent-color); background: var(--accent-glow); }

    .mood-history {
        border-top: 1px solid var(--border-color);
        padding-top: 15px;
    }

    .history-title {
        font-size: 0.8rem;
        color: var(--text-muted);
        margin-bottom: 10px;
        text-transform: uppercase;
    }

    .history-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
        text-align: center;
    }

    .history-item { display: flex; flex-direction: column; gap: 5px; }
    .history-date { font-size: 0.65rem; color: var(--text-muted); }
    .history-emoji {
        font-size: 1.1rem;
        height: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .history-emoji.empty { color: var(--border-color); }
</style>

<script>
    function moodTracker() {
    return {
        selectedDate: new Date().toISOString().split('T')[0],
        currentMood: null,
        history: {},
        moodTypes: [
            { emoji: 'üòÑ', label: 'Skvƒõle' },
            { emoji: 'üôÇ', label: 'Dob≈ôe' },
            { emoji: 'üòê', label: 'Ujde to' },
            { emoji: 'üòï', label: '≈†patnƒõ' },
            { emoji: 'üò°', label: 'Na≈°tvanƒõ' }
        ],
        lastWeek: [],

        init() {
            this.loadHistory();
            this.generateLastWeekLabels();
            this.loadMoodForDate();
        },

        generateLastWeekLabels() {
            const days = [];
            const dayNames = ['Ne', 'Po', '√öt', 'St', 'ƒåt', 'P√°', 'So'];
            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                const dateStr = d.toISOString().split('T')[0];
                days.push({
                    date: dateStr,
                    label: i === 0 ? 'Dnes' : dayNames[d.getDay()]
                });
            }
            this.lastWeek = days;
        },

        saveMood(emoji) {
            this.currentMood = emoji;
            this.history[this.selectedDate] = emoji;
            localStorage.setItem('dashboard_moods', JSON.stringify(this.history));
        },

        loadMoodForDate() {
            this.currentMood = this.history[this.selectedDate] || null;
        },

        loadHistory() {
            const stored = localStorage.getItem('dashboard_moods');
            this.history = stored ? JSON.parse(stored) : {};
        }
    }
}
</script>